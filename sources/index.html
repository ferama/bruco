<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.83.1"><meta name=viewport content="width=device-width,initial-scale=1"><title>Sources &#183; Bruco üêõ</title><meta name=description content><link type=text/css rel=stylesheet href=https://ferama.github.io/bruco/css/print.css media=print><link type=text/css rel=stylesheet href=https://ferama.github.io/bruco/css/poole.css><link type=text/css rel=stylesheet href=https://ferama.github.io/bruco/css/syntax.css><link type=text/css rel=stylesheet href=https://ferama.github.io/bruco/css/hyde.css><link type=text/css rel=stylesheet href=https://ferama.github.io/bruco/css/overrides.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body class=theme-base-0d><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://ferama.github.io/bruco/><h1>Bruco üêõ</h1></a><p class=lead>Easy build streaming pipelines. Handle business logic in python</p></div><nav><ul class=sidebar-nav><li><a href=https://ferama.github.io/bruco/>Home</a></li><li><a href=/bruco/getting-started>Getting started on k8s</a></li><li><a href=/bruco/config-file>Config</a></li><ul><li><a href=/bruco/sources>Sources</a></li><li><a href=/bruco/sinks>Sinks</a></li><li><a href=/bruco/processor>Processor</a></li></ul><li><a href=https://github.com/ferama/bruco><i class="fab fa-github"></i> Star Bruco on Github</a></li></ul></nav><p>&copy; 2021. All rights reserved.</p></div></aside><main class="content container"><div class=post><h1>Sources</h1><p>Actually bruco supports the following event sources:</p><ol><li>HTTP</li><li>Apache Kafka</li><li>NATS</li></ol><h2 id=the-http-event-source>The HTTP event source</h2><p>The http source is activated using the <code>http</code> kind</p><table><thead><tr><th>yaml path</th><th>description</th></tr></thead><tbody><tr><td>ignoreProcessorResponse</td><td>If true doen&rsquo;t return the prcessed value to the http caller</td></tr><tr><td>port</td><td>the port the http server listens too (do not change this if you are using bruco with k8s)</td></tr></tbody></table><p>Example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>source</span>:
  <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>http</span>
  <span style=color:#f92672>ignoreProcessorResponse</span>: <span style=color:#66d9ef>false</span>
  <span style=color:#75715e># port: 8090</span>
</code></pre></div><h2 id=the-kafka-event-source>The Kafka event source</h2><p>Bruco uses Sarama (<a href=https://github.com/Shopify/sarama>https://github.com/Shopify/sarama</a>) as kafka library.</p><p>The kafka source is activated using the <code>kafka</code> kind</p><table><thead><tr><th>yaml path</th><th>description</th></tr></thead><tbody><tr><td>brokers</td><td>a list of kafka brokers to connect to</td></tr><tr><td>topics</td><td>a list of topics to subscribe too</td></tr><tr><td>offset</td><td>the initial offset where the kafka consumer will start to consume</td></tr><tr><td>consumerGroup</td><td>the kafka consumer group</td></tr><tr><td>balanceStrategy</td><td>the kafka consumer balance startegy</td></tr><tr><td>fireAndForget</td><td>if true, the first available worker will process a message, regardless of partition message order</td></tr><tr><td>rebalanceTimeout</td><td>kafka rebalanceTimeout</td></tr><tr><td>channelBufferSize</td><td>the size of consumer buffer</td></tr><tr><td>fetchDefaultBytes</td><td>the size in bytes to fetch from the topic each time</td></tr></tbody></table><p>Example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>source</span>:
  <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>kafka</span>
  <span style=color:#f92672>brokers</span>:
    - <span style=color:#ae81ff>localhost:9092</span>
  <span style=color:#f92672>topics</span>:
    - <span style=color:#ae81ff>test1</span>
    - <span style=color:#ae81ff>test2</span>
  <span style=color:#75715e># OPTIONAL: default latest. values: latest, earliest</span>
  <span style=color:#f92672>offset</span>: <span style=color:#ae81ff>latest</span>
  <span style=color:#f92672>consumerGroup</span>: <span style=color:#ae81ff>my-consumer-group</span>
  <span style=color:#75715e># OPTIONAL: default range. values: range, sticky, roundrobin</span>
  <span style=color:#f92672>balanceStrategy</span>: <span style=color:#ae81ff>range</span>
  <span style=color:#75715e># NOTE: the async version (fireAndForget=true) will not guarantee</span>
  <span style=color:#75715e># messages handling order between same partition</span>
  <span style=color:#f92672>fireAndForget</span>: <span style=color:#66d9ef>false</span>
  <span style=color:#75715e># OPTIONAL: default 60</span>
  <span style=color:#75715e># Increase this one if you have slow consumers to prevent</span>
  <span style=color:#75715e># rebalance loop</span>
  <span style=color:#f92672>rebalanceTimeout</span>: <span style=color:#ae81ff>120</span>
  <span style=color:#75715e># OPTIONAL: default to 256. Put a low vaclue here in case of slow consumers</span>
  <span style=color:#75715e># to prevent rebalancing loop. It can be as low as 0</span>
  <span style=color:#f92672>channelBufferSize</span>: <span style=color:#ae81ff>256</span>
  <span style=color:#75715e># OPTIONAL: default 1024 * 1024. Again for slow consumers you could keep this low</span>
  <span style=color:#f92672>fetchDefaultBytes</span>: <span style=color:#ae81ff>8</span>
</code></pre></div><h4 id=understand-the-balancestrategy-param>Understand the balanceStrategy param</h4><p>The balanceStrategy param, let&rsquo;s you config the partition assignment strategy per consumer.
There are 3 available values:</p><ol><li>Range (default)</li><li>Stick</li><li>Round Robin</li></ol><p>The <strong>range</strong> partition strategy, distributes partitions to consumers as ranges.
Example:
suppose you have 6 partitions and two consumers. The assignement strategy will be like:</p><pre><code>  c1: [p0, p1, p2]
  c2: [p3, p4, p5]
</code></pre><p>The <strong>sticky</strong> partition strategy, will assign partitions to consumer trying to keep previous assignment while at the sime time obtaining a balanced partition distribution.
Example:
you have 6 partition and two consumer with an assignment like:</p><pre><code>  c1: [p0, p2, p4]
  c2: [p1, p3, p5]
</code></pre><p>then a new consumer joins the consumer group. You could obtain a reassigment like:</p><pre><code>  c1: [p0, p2]
  c2: [p1, p3]
  c3: [p4, p5]
</code></pre><p>The <strong>roundrobin</strong> partition strategy, uses a round robin parition distribution between consumers.
Example:
with 6 paritions and two consumers, you will get:</p><pre><code>  c1: [p0, p2, p4]
  c2: [p1, p3, p5]
</code></pre><h2 id=the-nats-event-source>The NATS event source</h2><p>The NATS source is activated using the <code>nats</code> kind</p><p>Example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>source</span>:
  <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>nats</span>
  <span style=color:#f92672>serverUrl</span>: <span style=color:#ae81ff>localhost:4222</span>
  <span style=color:#f92672>queueGroup</span>: <span style=color:#ae81ff>test</span>
  <span style=color:#f92672>subject</span>: <span style=color:#ae81ff>in.sub</span>
</code></pre></div></div></main></body></html>